# Fail2Ban Filters for MariaIntelligence Security Events
# These filters parse the JSON security logs generated by our enhanced security middleware

[Definition]
# MariaIntelligence API abuse filter
mariaintelligence-api = ^.*"ip":\s*"<HOST>".*"type":\s*"RATE_LIMIT_EXCEEDED".*$

# DDoS attack detection filter
mariaintelligence-ddos = ^.*"ip":\s*"<HOST>".*"type":\s*"DDoS_DETECTED".*$

# Brute force attack detection filter
mariaintelligence-bruteforce = ^.*"ip":\s*"<HOST>".*"type":\s*"BRUTE_FORCE_DETECTED".*$

# XSS attack attempt filter
mariaintelligence-xss = ^.*"ip":\s*"<HOST>".*"type":\s*"XSS_ATTEMPT".*$

# SQL injection attempt filter
mariaintelligence-sqlinjection = ^.*"ip":\s*"<HOST>".*"type":\s*"SQL_INJECTION_ATTEMPT".*$

# General suspicious activity filter
mariaintelligence-suspicious = ^.*"ip":\s*"<HOST>".*"type":\s*"SUSPICIOUS_REQUEST".*$

# Bot/crawler detection filter
mariaintelligence-crawler = ^.*"ip":\s*"<HOST>".*"type":\s*"BOT_TRAFFIC_DETECTED".*$

# Advanced filters for specific patterns
[mariaintelligence-api]
datepattern = "timestamp":\s*"%%Y-%%m-%%dT%%H:%%M:%%S
failregex = ^.*"ip":\s*"<HOST>".*"type":\s*"RATE_LIMIT_EXCEEDED".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"PAYLOAD_TOO_LARGE".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"CORS_VIOLATION".*$
ignoreregex =

[mariaintelligence-ddos]
datepattern = "timestamp":\s*"%%Y-%%m-%%dT%%H:%%M:%%S
failregex = ^.*"ip":\s*"<HOST>".*"type":\s*"DDoS_DETECTED".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"ANOMALOUS_BEHAVIOR".*"severity":\s*"critical".*$
ignoreregex =

[mariaintelligence-bruteforce]
datepattern = "timestamp":\s*"%%Y-%%m-%%dT%%H:%%M:%%S
failregex = ^.*"ip":\s*"<HOST>".*"type":\s*"BRUTE_FORCE_DETECTED".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"AUTHENTICATION_FAILED".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"PERMISSION_DENIED".*$
ignoreregex =

[mariaintelligence-xss]
datepattern = "timestamp":\s*"%%Y-%%m-%%dT%%H:%%M:%%S
failregex = ^.*"ip":\s*"<HOST>".*"type":\s*"XSS_ATTEMPT".*$
ignoreregex =

[mariaintelligence-sqlinjection]
datepattern = "timestamp":\s*"%%Y-%%m-%%dT%%H:%%M:%%S
failregex = ^.*"ip":\s*"<HOST>".*"type":\s*"SQL_INJECTION_ATTEMPT".*$
ignoreregex =

[mariaintelligence-suspicious]
datepattern = "timestamp":\s*"%%Y-%%m-%%dT%%H:%%M:%%S
failregex = ^.*"ip":\s*"<HOST>".*"type":\s*"SUSPICIOUS_REQUEST".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"DIRECTORY_TRAVERSAL".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"COMMAND_INJECTION".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"FILE_UPLOAD_REJECTED".*$
            ^.*"ip":\s*"<HOST>".*"type":\s*"VALIDATION_FAILED".*$
ignoreregex =

[mariaintelligence-crawler]
datepattern = "timestamp":\s*"%%Y-%%m-%%dT%%H:%%M:%%S
failregex = ^.*"ip":\s*"<HOST>".*"type":\s*"BOT_TRAFFIC_DETECTED".*$
ignoreregex = ^.*"allowedBot":\s*true.*$