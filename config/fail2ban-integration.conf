# Fail2Ban Configuration for MariaIntelligence Security
# /etc/fail2ban/jail.local integration

[DEFAULT]
# Global settings
bantime = 3600          # 1 hour ban
findtime = 600          # 10 minute window
maxretry = 5            # Allow 5 attempts before ban
backend = auto
usedns = warn
logencoding = auto
enabled = true

# Email notification settings
destemail = security@mariaintelligence.com
sendername = MariaIntelligence-Security
mta = sendmail
action = %(action_mwl)s

[mariaintelligence-api]
enabled = true
port = http,https,5100,5001
filter = mariaintelligence-api
logpath = /var/log/mariaintelligence/security-audit-*.json
maxretry = 10
findtime = 600
bantime = 7200
action = iptables-multiport[name=mariaintelligence-api, port="http,https,5100,5001", protocol=tcp]
         sendmail-whois[name=mariaintelligence-api, dest=security@mariaintelligence.com]

[mariaintelligence-ddos]
enabled = true
port = http,https,5100,5001
filter = mariaintelligence-ddos
logpath = /var/log/mariaintelligence/security-audit-*.json
maxretry = 3
findtime = 60
bantime = 14400         # 4 hours
action = iptables-multiport[name=mariaintelligence-ddos, port="http,https,5100,5001", protocol=tcp]
         sendmail-whois[name=mariaintelligence-ddos, dest=security@mariaintelligence.com]

[mariaintelligence-bruteforce]
enabled = true
port = http,https,5100,5001
filter = mariaintelligence-bruteforce
logpath = /var/log/mariaintelligence/security-audit-*.json
maxretry = 3
findtime = 300
bantime = 21600         # 6 hours
action = iptables-multiport[name=mariaintelligence-bruteforce, port="http,https,5100,5001", protocol=tcp]
         sendmail-whois[name=mariaintelligence-bruteforce, dest=security@mariaintelligence.com]

[mariaintelligence-xss]
enabled = true
port = http,https,5100,5001
filter = mariaintelligence-xss
logpath = /var/log/mariaintelligence/security-audit-*.json
maxretry = 1            # Zero tolerance for XSS
findtime = 86400        # 24 hour window
bantime = 86400         # 24 hour ban
action = iptables-multiport[name=mariaintelligence-xss, port="http,https,5100,5001", protocol=tcp]
         sendmail-whois[name=mariaintelligence-xss, dest=security@mariaintelligence.com]

[mariaintelligence-sqlinjection]
enabled = true
port = http,https,5100,5001
filter = mariaintelligence-sqlinjection
logpath = /var/log/mariaintelligence/security-audit-*.json
maxretry = 1            # Zero tolerance for SQL injection
findtime = 86400        # 24 hour window
bantime = 86400         # 24 hour ban
action = iptables-multiport[name=mariaintelligence-sqlinjection, port="http,https,5100,5001", protocol=tcp]
         sendmail-whois[name=mariaintelligence-sqlinjection, dest=security@mariaintelligence.com]

[mariaintelligence-suspicious]
enabled = true
port = http,https,5100,5001
filter = mariaintelligence-suspicious
logpath = /var/log/mariaintelligence/security-audit-*.json
maxretry = 15
findtime = 3600         # 1 hour window
bantime = 3600          # 1 hour ban
action = iptables-multiport[name=mariaintelligence-suspicious, port="http,https,5100,5001", protocol=tcp]

[mariaintelligence-crawler]
enabled = true
port = http,https,5100,5001
filter = mariaintelligence-crawler
logpath = /var/log/mariaintelligence/security-audit-*.json
maxretry = 50
findtime = 3600
bantime = 1800          # 30 minutes
action = iptables-multiport[name=mariaintelligence-crawler, port="http,https,5100,5001", protocol=tcp]

# Standard protection for SSH (if applicable)
[sshd]
enabled = true
port = ssh
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = 3
bantime = 86400

# Additional protection for web server logs
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 3600

[nginx-noscript]
enabled = true
filter = nginx-noscript
logpath = /var/log/nginx/access.log
maxretry = 6
bantime = 86400

[nginx-badbots]
enabled = true
filter = nginx-badbots
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400

[nginx-noproxy]
enabled = true
filter = nginx-noproxy
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400